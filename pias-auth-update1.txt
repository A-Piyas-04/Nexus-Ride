# Project Updates - Session Log

## 1. Documentation & Project Structure
- **Created `README.md`**: Added comprehensive documentation covering project overview, file structure, prerequisites, installation steps, configuration, and API usage.
- **Created `.gitignore`**: Added standard exclusions for Python (venv, __pycache__), Docker, IDEs, and environment files.

## 2. Environment Configuration
- **Created `.env`**: Configured environment variables for local development (`DATABASE_URL`, `SECRET_KEY`).
- **Updated `requirements.txt`**: 
  - Added `python-dotenv` to load environment variables.
  - **Fixed Bcrypt/Passlib Compatibility**:
    - *Error*: `AttributeError: module 'bcrypt' has no attribute '__about__'`
    - *Cause*: The `passlib` library relies on the `__about__` attribute to check the version of the underlying `bcrypt` library. Newer versions of `bcrypt` (4.1.0+) removed this attribute, causing `passlib` to crash during password hashing operations.
    - *Fix*: Downgraded `bcrypt` to version `4.0.1` in `requirements.txt`, which retains the `__about__` attribute and restores compatibility with `passlib`.
- **Updated `app/main.py`**: Added `load_dotenv()` at the start of the application to ensure environment variables are available immediately.

## 3. Docker Setup
- **Created `.dockerignore`**: Excluded `venv`, `.env`, and temporary files from the build context.
- **Updated `docker-compose.yml`**:
  - Upgraded PostgreSQL image to `postgres:15`.
  - Added `restart: always` policy for services.
  - Added a named volume `postgres_data` for database persistence.
  - Injected `SECRET_KEY` and `ALGORITHM` environment variables into the API container.

## 4. Database & Application Fixes
- **Database Initialization**: 
  - Modified `app/main.py` to include a `lifespan` event handler.
  - Implemented `SQLModel.metadata.create_all(engine)` to automatically create database tables on application startup.
- **Fixed Schema Type Mismatches**:
  - *Error*: `sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DatatypeMismatch) foreign key constraint ... cannot be implemented`
  - *Cause*: The `User` model uses a `UUID` type for its primary key. However, the `UserRole` and `Subscription` models originally defined their `user_id` foreign keys as `str` (String). PostgreSQL strictly enforces type matching for foreign keys and does not allow linking a `UUID` column to a `VARCHAR/TEXT` column.
  - *Fix*: Updated `app/models/role.py` and `app/models/subscription.py` to change the `user_id` field definition from `str` to `UUID`. This ensures the foreign key columns match the type of the referenced `User.id` column.

## 5. Verification
- Validated `POST /auth/signup` endpoint: Successfully creates a new user.
- Validated `POST /auth/login` endpoint: Successfully returns a JWT access token.
